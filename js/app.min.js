/*Build at 31-10-2017*/function handlerError(a,b){switch(a){case 401:document.cookie=config.cookie_token+"=; Max-Age=0",window.location="index.html";break;case 400:debug(b),show(-1,b)}}function formatCurrency(a){if(void 0===a)return 0;var b=a.toString().replace(/\$|\,/g,"");if(""==a&&(b=0),/\./.test(b))return b;if(isNaN(b))return!1;for(var c=0;c<Math.floor((b.length-(1+c))/3);c++)b=b.substring(0,b.length-(4*c+3))+"."+b.substring(b.length-(4*c+3));return b}function formatDate(a){return void 0===a?"":moment(new Date(a)).format("YYYY/MM/DD HH:mm:ss")}function getCurrentDate(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate();if(1==c.toString().length)var c="0"+c;if(1==d.toString().length)var d="0"+d;var e=d+"/"+c+"/"+b;return e}function isEmpty(a){return"undefined"==typeof a||!a||0===a.length}function showAlert(a){$(".alert").html(a),$(".alert").show(),window.setTimeout(function(){$(".alert").fadeTo(1500,0).slideUp(500,function(){$(".alert").html(""),$(".alert").hide()})},3e3)}function show(a,b){a==SUCCESS?notif({msg:b,type:"success"}):notif({msg:b,type:"error"})}function debug(a){console.log(a)}function DocSo3ChuSo(a){var b,c,d,e="";if(b=parseInt(a/100),c=parseInt(a%100/10),d=a%10,0==b&&0==c&&0==d)return"";switch(0!=b&&(e+=ChuSo[b]+" trăm ",0==c&&0!=d&&(e+=" linh ")),0!=c&&1!=c&&(e+=ChuSo[c]+" mươi",0==c&&0!=d&&(e+=" linh ")),1==c&&(e+=" mười "),d){case 1:e+=0!=c&&1!=c?" mốt ":ChuSo[d];break;case 5:e+=0==c?ChuSo[d]:" lăm ";break;default:0!=d&&(e+=ChuSo[d])}return e}function DocTienBangChu(a){var b=0,c=0,d=0,e="",f="",g=!1,h=new Array;if(0>a&&(g=!0),0==a)return"";if(d=a>0?a:-a,a>8999999999999999)return"";for(h[5]=Math.floor(d/1e15),isNaN(h[5])&&(h[5]="0"),d-=1e15*parseFloat(h[5].toString()),h[4]=Math.floor(d/1e12),isNaN(h[4])&&(h[4]="0"),d-=1e12*parseFloat(h[4].toString()),h[3]=Math.floor(d/1e9),isNaN(h[3])&&(h[3]="0"),d-=1e9*parseFloat(h[3].toString()),h[2]=parseInt(d/1e6),isNaN(h[2])&&(h[2]="0"),h[1]=parseInt(d%1e6/1e3),isNaN(h[1])&&(h[1]="0"),h[0]=parseInt(d%1e3),isNaN(h[0])&&(h[0]="0"),b=h[5]>0?5:h[4]>0?4:h[3]>0?3:h[2]>0?2:h[1]>0?1:0,c=b;c>=0;c--)f=DocSo3ChuSo(h[c]),e+=f,h[c]>0&&(e+=Tien[c]),c>0&&f.length>0&&(e+="");return","==e.substring(e.length-1)&&(e=e.substring(0,e.length-1)),e=e.substring(1,2).toUpperCase()+e.substring(2),g?"Âm "+e+" đồng":e+" đồng"}function JSONToCSVConvertor(a,b,c){var d="object"!=typeof a?JSON.parse(a):a,e="";if(e+=b+"\r\n\n",c){var f="";for(var g in d[0])f+=g+",";f=f.slice(0,-1),e+=f+"\r\n"}for(var h=0;h<d.length;h++){var f="";for(var g in d[h])f+='"'+d[h][g]+'",';f.slice(0,f.length-1),e+=f+"\r\n"}if(""==e)return void alert("Invalid data");var i="Report_";i+=b.replace(/ /g,"_");var j="data:text/csv;charset=utf-8,"+escape(e),k=document.createElement("a");k.href=j,k.style="visibility:hidden",k.download=i+".csv",document.body.appendChild(k),k.click(),document.body.removeChild(k)}function replaceAll(a,b,c){return a.replace(new RegExp(b,"g"),c)}function timeSince(a){var b=Math.floor((new Date-a)/1e3),c=Math.floor(b/31536e3);return c>1?c+" years":(c=Math.floor(b/2592e3),c>1?c+" months":(c=Math.floor(b/86400),c>1?c+" days":(c=Math.floor(b/3600),c>1?c+" hours":(c=Math.floor(b/60),c>1?c+" minutes":Math.floor(b)+" seconds"))))}var app=angular.module("myApp",["ui.router","ngCookies","angular-loading-bar","caco.ClientPaginate"]);const config={header_token:"X-Access-Token",cookie_token:"token",url:"https://doithenhanh.com/api/"};app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"pages/wapper.html",controller:"homeController"}).state("wapper",{url:"/wapper.html?token&expire",templateUrl:"pages/wapper.html",controller:"wapperController"}).state("charge",{url:"/charge.html",templateUrl:"pages/charge.html",controller:"chargeController"}).state("transfer",{url:"/transfer.html",templateUrl:"pages/transfer.html",controller:"transferController"}).state("payment",{url:"/payment.html",templateUrl:"pages/payment.html",controller:"paymentController"}).state("topup",{url:"/topup.html",templateUrl:"pages/topup.html",controller:"topupController"}).state("softpin-mobile",{url:"/softpin-mobile.html",templateUrl:"pages/softpin-mobile.html",controller:"softpinController"}).state("softpin-game",{url:"/softpin-game.html",templateUrl:"pages/softpin-game.html",controller:"softpinController"}).state("login",{url:"/login.html",templateUrl:"pages/login.html",controller:"loginController"}).state("logout",{url:"/logout.html",controller:"logoutController"}).state("register",{url:"/register.html",templateUrl:"pages/register.html",controller:"registerController"}).state("forgotPassword",{url:"/forgot-password.html",templateUrl:"pages/forgot-password.html",controller:"forgotPasswordController"}).state("fee",{url:"/fee.html",templateUrl:"pages/fee.html",controller:"feeController"}).state("profile",{url:"/profile.html",templateUrl:"pages/profile.html",controller:"profileController"}).state("changePassword",{url:"/change-password.html",templateUrl:"pages/change-password.html",controller:"changePasswordController"}).state("changePassword2",{url:"/change-password2.html",templateUrl:"pages/change-password2.html",controller:"changePassword2Controller"}).state("bank",{url:"/bank.html",templateUrl:"pages/bank.html",controller:"bankController"}).state("changeBank",{url:"/change-bank.html",templateUrl:"pages/change-bank.html",controller:"changeBankController"}).state("logBalance",{url:"/log-balance.html",templateUrl:"pages/log-balance.html",controller:"logBalanceController"}).state("history",{url:"/history.html",templateUrl:"pages/history.html",controller:"historyController"}).state("history.charge",{url:"/history-charge.html",templateUrl:"pages/history-charge.html",controller:"historyChargeController"}).state("history.payment",{url:"/history-payment.html",templateUrl:"pages/history-payment.html",controller:"historyPaymentController"}).state("history.transfer",{url:"/history-transfer.html",templateUrl:"pages/history-transfer.html",controller:"historyTransferController"}).state("history.topup",{url:"/history-topup.html",templateUrl:"pages/history-topup.html",controller:"historyTopupController"}).state("history.softpin",{url:"/history-softpin.html",templateUrl:"pages/history-softpin.html",controller:"historySoftpinController"}).state("api-setup",{url:"/api-setup.html",templateUrl:"pages/api-setup.html",controller:"apiSetupController"})}]),app.run(["$rootScope","$cookieStore","$location","$http","$state",function(a,b,c,d,e){var f=b.get(config.cookie_token)||{};f.value?(d.defaults.headers.common[config.header_token]=f.value,$("#login-menu").hide(),$("#user-menu").show(),d.get(config.url+"portal/user").then(function(b){a.user=b.data},function(a){handlerError(a.status,a.data.message)})):c.path("/wapper.html"),d.get(config.url+"portal/fee").then(function(b){a.discount=b.data},function(a){handlerError(a.status,a.data.message)}),a.formatCurrency=function(a){return formatCurrency(Math.round(a))},a.formatDate=function(a){return formatDate(a)},a.setPassword2=function(){$("#sellModal").modal("hide"),e.go("changePassword2")},a.round=function(a){return Math.round(1e5*a)/1e3}}]),app.controller("apiSetupController",["$rootScope","$scope","$cookieStore","$location","$http","$timeout",function(a,b,c,d,e,f){e.get(config.url+"portal/user").then(function(b){a.user=b.data},function(a){handlerError(a.status,a.data.message)}),b.createKey=function(){BootstrapDialog.confirm({title:"Xác nhận",message:"Bạn có muốn tạo key để kết nối qua API?",callback:function(b){b&&e.get(config.url+"portal/create-key-api").then(function(b){show(b.data.code,b.data.message),e.get(config.url+"portal/user").then(function(b){a.user=b.data},function(a){handlerError(a.status,a.data.message)})},function(a){handlerError(a.status,a.data.message)})}})}}]),app.controller("bankController",["$scope","$cookieStore","$location","$http","$state",function(a,b,c,d,e){a.add=function(){e.go("changeBank")},a["delete"]=function(b){BootstrapDialog.confirm({title:"Xác nhận",message:"Xác nhận xóa tài khoản rút tiền "+b+"?",callback:function(c){c&&d.get(config.url+"portal/remove-bank?account="+b).then(function(b){show(b.data.code,b.data.message),d.get(config.url+"portal/bank").then(function(b){a.data=b.data},function(a){handlerError(a.status,a.data.message)})},function(a){handlerError(a.status,a.data.message)})}})},d.get(config.url+"portal/bank").then(function(b){a.data=b.data},function(a){handlerError(a.status,a.data.message)})}]),app.controller("changeBankController",["$rootScope","$scope","$cookieStore","$location","$http","$state",function(a,b,c,d,e,f){b.add=function(){BootstrapDialog.show({type:BootstrapDialog.TYPE_DEFAULT,title:"Xác nhận",message:'Nhập mật khẩu cấp 2: <input type="password" class="form-control x1">'+(1==a.user.useOdp?'Nhập mã ODP: <input type="password" class="form-control x2">':""),buttons:[{label:"Hủy bỏ",action:function(a){a.close()}},{label:"Đồng ý",action:function(a){var b={bank:$("select[name=bank]").val(),account:$("input[name=account]").val(),name:$("input[name=name]").val(),password2:a.getModalBody().find("input.x1").val(),odp:a.getModalBody().find("input.x2").val()};e.post(config.url+"portal/bank",b).then(function(a){show(a.data.code,a.data.message),0==a.data.code&&f.go("bank")},function(a){handlerError(a.status,a.data.message)}),a.close()}}]})}}]),app.controller("changePasswordController",["$scope","$cookieStore","$location","$http",function(a,b,c,d){a.changePassword=function(){var b={oldPass:a.password,newPass:a.newPassword,reNewPass:a.rePassword};d.post(config.url+"portal/change-password",b).then(function(b){show(b.data.code,b.data.message),a.password="",a.newPassword="",a.rePassword=""},function(a){handlerError(a.status,a.data.message)})}}]),app.controller("changePassword2Controller",["$rootScope","$scope","$cookieStore","$location","$http",function(a,b,c,d,e){b.changePassword2=function(){var c={oldPass:$("input[name=password]").val(),newPass:b.newPassword,reNewPass:b.rePassword};e.post(config.url+"portal/change-password2",c).then(function(c){show(c.data.code,c.data.message),$("input[name=password]").val(""),b.newPassword="",b.rePassword="",e.get(config.url+"portal/user").then(function(b){a.user=b.data},function(a){handlerError(a.status,a.data.message)})},function(a){handlerError(a.status,a.data.message)})}}]),app.controller("chargeController",["$rootScope","$scope","$cookieStore","$location","$http","$timeout",function(a,b,c,d,e,f){$("input:radio").change(function(){$("div label.btn").attr("class","btn btn-default"),$("input[name=provider]:checked").parent().attr("class","btn btn-default active")}),e.get(config.url+"portal/charge/scoin-status").then(function(a){b.scoinActive=a.data,b.scoinActive?$("#scoinActive").show():$("#scoinActive").hide()},function(a){handlerError(a.status,a.data.message)}),b.charge=function(){var c={provider:$("input[name=provider]:checked").val(),serial:replaceAll(b.serial,"\\s",""),pin:replaceAll(b.pin,"\\s","")};e.post(config.url+"portal/charge",c).then(function(c){show(c.data.code,c.data.message),0==c.data.code&&(e.get(config.url+"portal/user").then(function(b){a.user=b.data},function(a){handlerError(a.status,a.data.message)}),b.serial="",b.pin="")},function(a){handlerError(a.status,a.data.message)})}}]),app.controller("feeController",["$rootScope","$scope","$cookieStore","$location","$http","$timeout",function(a,b,c,d,e,f){e.get(config.url+"portal/fee").then(function(b){a.discount=b.data},function(a){handlerError(a.status,a.data.message)})}]),app.controller("forgotPasswordController",["$scope","$cookieStore","$location","$http","$timeout",function(a,b,c,d,e){var f;d.get(config.url+"captcha").then(function(a){f=a.data.id,$("#captcha").attr("src",a.data.base64Img)},function(a){handlerError(a.status,a.data.message)}),a.forgotPassword=function(){var b={email:a.email,captcha:a.captcha,captchaId:f};d.post(config.url+"portal/forgot-password",b).then(function(a){show(a.data.code,a.data.message)},function(a){handlerError(a.status,a.data.message),d.get(config.url+"captcha").then(function(a){f=a.data.id,$("#captcha").attr("src",a.data.base64Img)},function(a){handlerError(a.status,a.data.message)})})}}]),app.controller("historyChargeController",["$scope","$cookieStore","$location","$http","$timeout",function(b,c,d,e,f){function g(){var a={key:$("select[name=key]").val(),value:$("input[name=value]").val(),status:$("select[name=status]").val(),fromDate:$("input[name=fromDate]").val(),toDate:$("input[name=toDate]").val()};e.post(config.url+"portal/history-charge",a).then(function(a){b.data=a.data,b.sumAmount=0,b.sumPayment=0,b.data.forEach(function(a){b.sumAmount+=a.amount,b.sumPayment+=a.payment})},function(a){handlerError(a.status,a.data.message)})}$("#charge").attr("class","active"),$("#payment").attr("class",""),$("#transfer").attr("class",""),$("#topup").attr("class",""),$("#softpin").attr("class",""),$("#carot").attr("class",""),g(),b.history=function(){g()},b.report=function(){var c='<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40"> <Worksheet ss:Name="Sheet1"> <Table>\r\n';c+='<Row><Cell><Data ss:Type="String">Thời gian</Data></Cell> <Cell><Data ss:Type="String">Tham chiếu</Data></Cell> <Cell><Data ss:Type="String">Thẻ</Data></Cell> <Cell><Data ss:Type="String">Serial</Data></Cell> <Cell><Data ss:Type="String">Pin</Data></Cell> <Cell><Data ss:Type="String">Mệnh giá</Data></Cell><Cell><Data ss:Type="String">Thanh toán</Data></Cell><Cell><Data ss:Type="String">Trạng thái</Data></Cell></Row>\r\n',b.data.forEach(function(a){var b='<Row><Cell><Data ss:Type="String">'+formatDate(a.reqTime)+'</Data></Cell> <Cell><Data ss:Type="String">'+a.id+'</Data></Cell> <Cell><Data ss:Type="String">'+a.provider+'</Data></Cell> <Cell><Data ss:Type="String">'+a.serial+'</Data></Cell> <Cell><Data ss:Type="String">'+a.pin+'</Data></Cell> <Cell><Data ss:Type="Number">'+a.amount+'</Data></Cell> <Cell><Data ss:Type="Number">'+a.payment+'</Data></Cell> <Cell><Data ss:Type="String">'+a.message+"</Data></Cell></Row>\r\n";c+=b+"\r\n"}),c+="</Table></Worksheet></Workbook>";"text/json;charset=utf-8,"+encodeURIComponent(c);a=document.createElement("a"),a.target="_blank",a.href="data:text/json;charset=utf-8,"+encodeURIComponent(c),a.download="report.xls",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}]),app.controller("historyPaymentController",["$scope","$cookieStore","$location","$http","$timeout",function(b,c,d,e,f){function g(){var a={key:$("select[name=key]").val(),value:$("input[name=value]").val(),status:$("select[name=status]").val(),fromDate:$("input[name=fromDate]").val(),toDate:$("input[name=toDate]").val()};e.post(config.url+"portal/history-payment",a).then(function(a){b.data=a.data,b.sumAmount=0,b.data.forEach(function(a){b.sumAmount+=a.amount})},function(a){handlerError(a.status,a.data.message)})}$("#charge").attr("class",""),$("#payment").attr("class","active"),$("#transfer").attr("class",""),$("#topup").attr("class",""),$("#softpin").attr("class",""),$("#carot").attr("class",""),g(),b.history=function(){g()},b.report=function(){var c='<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40"> <Worksheet ss:Name="Sheet1"> <Table>\r\n';c+='<Row><Cell><Data ss:Type="String">Thời gian</Data></Cell> <Cell><Data ss:Type="String">Tham chiếu</Data></Cell> <Cell><Data ss:Type="String">Ngân hàng</Data></Cell> <Cell><Data ss:Type="String">Tài khoản</Data></Cell> <Cell><Data ss:Type="String">Tên tài khoản</Data></Cell> <Cell><Data ss:Type="String">Số tiền</Data></Cell><Cell><Data ss:Type="String">Phí</Data></Cell><Cell><Data ss:Type="String">Trạng thái</Data></Cell></Row>\r\n',b.data.forEach(function(a){var b='<Row><Cell><Data ss:Type="String">'+formatDate(a.reqTime)+'</Data></Cell> <Cell><Data ss:Type="String">'+a.id+'</Data></Cell> <Cell><Data ss:Type="String">'+a.bank+'</Data></Cell> <Cell><Data ss:Type="String">'+a.account+'</Data></Cell> <Cell><Data ss:Type="String">'+a.name+'</Data></Cell> <Cell><Data ss:Type="Number">'+a.amount+'</Data></Cell> <Cell><Data ss:Type="Number">'+a.fee+'</Data></Cell> <Cell><Data ss:Type="String">'+a.message+"</Data></Cell></Row>\r\n";c+=b+"\r\n"}),c+="</Table></Worksheet></Workbook>";"text/json;charset=utf-8,"+encodeURIComponent(c);a=document.createElement("a"),a.target="_blank",a.href="data:text/json;charset=utf-8,"+encodeURIComponent(c),a.download="report.xls",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}]),app.controller("historySoftpinController",["$scope","$cookieStore","$location","$http","$timeout",function(b,c,d,e,f){function g(){var a={key:$("select[name=key]").val(),value:$("input[name=value]").val(),status:$("select[name=status]").val(),fromDate:$("input[name=fromDate]").val(),toDate:$("input[name=toDate]").val()};e.post(config.url+"portal/history-softpin",a).then(function(a){b.data=a.data,b.sumPayment=0,b.data.forEach(function(a){b.sumPayment+=a.payment})},function(a){handlerError(a.status,a.data.message)})}$("#charge").attr("class",""),$("#payment").attr("class",""),$("#transfer").attr("class",""),$("#topup").attr("class",""),$("#softpin").attr("class","active"),$("#carot").attr("class",""),g(),b.history=function(){g()},b.reSoftpin=function(a){BootstrapDialog.show({type:BootstrapDialog.TYPE_DEFAULT,title:"Xác nhận",message:'Nhập mật khẩu cấp 2: <input type="password" class="form-control x1">',buttons:[{label:"Hủy bỏ",action:function(a){a.close()}},{label:"Đồng ý",action:function(c){var d={id:a,password2:c.getModalBody().find("input.x1").val()};e.post(config.url+"portal/re-softpin",d).then(function(a){if(0==a.data.code){b.softpinList=a.data.softpinList,$("#result").show();var c="Stt	 Loại	Mệnh giá	Serial		Mã thẻ		Hạn sử dụng\r\n",d=1;for(var e in b.softpinList)c+=d+"	"+b.softpinList[e].provider+"	"+b.softpinList[e].amount+"	"+b.softpinList[e].serial+"	"+b.softpinList[e].pin+"	"+b.softpinList[e].expire+"\r\n",d++;var f="text/json;charset=utf-8,"+encodeURIComponent(c);$("#exportData").html('<a href="data:'+f+'" download="mã thẻ.txt"><i class="fa fa-download"></i> Tải file </a>'),document.getElementById("exportData").scrollIntoView()}},function(a){handlerError(a.status,a.data.message)}),c.close()}}]})},b.report=function(){var c='<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40"> <Worksheet ss:Name="Sheet1"> <Table>\r\n';c+='<Row><Cell><Data ss:Type="String">Thời gian</Data></Cell> <Cell><Data ss:Type="String">Tham chiếu</Data></Cell> <Cell><Data ss:Type="String">Thẻ</Data></Cell> <Cell><Data ss:Type="String">Mệnh giá</Data></Cell> <Cell><Data ss:Type="String">Số lượng</Data></Cell> <Cell><Data ss:Type="String">Thanh toán</Data></Cell><Cell><Data ss:Type="String">Trạng thái</Data></Cell></Row>\r\n',b.data.forEach(function(a){var b='<Row><Cell><Data ss:Type="String">'+formatDate(a.reqTime)+'</Data></Cell> <Cell><Data ss:Type="String">'+a.id+'</Data></Cell> <Cell><Data ss:Type="String">'+a.provider+'</Data></Cell> <Cell><Data ss:Type="Number">'+a.amount+'</Data></Cell> <Cell><Data ss:Type="Number">'+a.quantity+'</Data></Cell> <Cell><Data ss:Type="Number">'+a.payment+'</Data></Cell> <Cell><Data ss:Type="String">'+a.message+"</Data></Cell></Row>\r\n";c+=b+"\r\n"}),c+="</Table></Worksheet></Workbook>";"text/json;charset=utf-8,"+encodeURIComponent(c);a=document.createElement("a"),a.target="_blank",a.href="data:text/json;charset=utf-8,"+encodeURIComponent(c),a.download="report.xls",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}]),app.controller("historyTopupController",["$scope","$cookieStore","$location","$http","$timeout",function(b,c,d,e,f){function g(){var a={key:$("select[name=key]").val(),value:$("input[name=value]").val(),status:$("select[name=status]").val(),fromDate:$("input[name=fromDate]").val(),toDate:$("input[name=toDate]").val()};e.post(config.url+"portal/history-topup",a).then(function(a){b.data=a.data,b.sumAmount=0,b.sumPayment=0,b.data.forEach(function(a){b.sumAmount+=a.amount,b.sumPayment+=a.payment})},function(a){handlerError(a.status,a.data.message)})}$("#charge").attr("class",""),$("#payment").attr("class",""),$("#transfer").attr("class",""),$("#topup").attr("class","active"),$("#softpin").attr("class",""),$("#carot").attr("class",""),g(),b.history=function(){g()},b.report=function(){var c='<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40"> <Worksheet ss:Name="Sheet1"> <Table>\r\n';c+='<Row><Cell><Data ss:Type="String">Thời gian</Data></Cell> <Cell><Data ss:Type="String">Tham chiếu</Data></Cell> <Cell><Data ss:Type="String">Mạng</Data></Cell> <Cell><Data ss:Type="String">Số nạp</Data></Cell> <Cell><Data ss:Type="String">Số tiền</Data></Cell><Cell><Data ss:Type="String">Thanh toán</Data></Cell><Cell><Data ss:Type="String">Trạng thái</Data></Cell></Row>\r\n',b.data.forEach(function(a){var b='<Row><Cell><Data ss:Type="String">'+formatDate(a.reqTime)+'</Data></Cell> <Cell><Data ss:Type="String">'+a.id+'</Data></Cell> <Cell><Data ss:Type="String">'+a.provider+'</Data></Cell> <Cell><Data ss:Type="String">'+a.target+'</Data></Cell> <Cell><Data ss:Type="Number">'+a.amount+'</Data></Cell> <Cell><Data ss:Type="Number">'+a.payment+'</Data></Cell> <Cell><Data ss:Type="String">'+a.message+"</Data></Cell></Row>\r\n";c+=b+"\r\n"}),c+="</Table></Worksheet></Workbook>";"text/json;charset=utf-8,"+encodeURIComponent(c);a=document.createElement("a"),a.target="_blank",a.href="data:text/json;charset=utf-8,"+encodeURIComponent(c),a.download="report.xls",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}]),app.controller("historyTransferController",["$scope","$cookieStore","$location","$http","$timeout",function(b,c,d,e,f){function g(){var a={key:$("select[name=key]").val(),value:$("input[name=value]").val(),status:$("select[name=status]").val(),fromDate:$("input[name=fromDate]").val(),toDate:$("input[name=toDate]").val()};e.post(config.url+"portal/history-transfer",a).then(function(a){b.data=a.data,b.sumAmount=0,b.data.forEach(function(a){b.sumAmount+=a.amount})},function(a){handlerError(a.status,a.data.message)})}$("#charge").attr("class",""),$("#payment").attr("class",""),$("#transfer").attr("class","active"),$("#topup").attr("class",""),$("#softpin").attr("class",""),$("#carot").attr("class",""),g(),b.history=function(){g()},b.report=function(){var c='<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40"> <Worksheet ss:Name="Sheet1"> <Table>\r\n';c+='<Row><Cell><Data ss:Type="String">Thời gian</Data></Cell> <Cell><Data ss:Type="String">Tham chiếu</Data></Cell> <Cell><Data ss:Type="String">Chuyển tới</Data></Cell> <Cell><Data ss:Type="String">Số tiền</Data></Cell><Cell><Data ss:Type="String">Phí</Data></Cell><Cell><Data ss:Type="String">Trạng thái</Data></Cell></Row>\r\n',b.data.forEach(function(a){var b='<Row><Cell><Data ss:Type="String">'+formatDate(a.reqTime)+'</Data></Cell> <Cell><Data ss:Type="String">'+a.id+'</Data></Cell> <Cell><Data ss:Type="String">'+a.toName+'</Data></Cell> <Cell><Data ss:Type="Number">'+a.amount+'</Data></Cell> <Cell><Data ss:Type="Number">'+a.fee+'</Data></Cell> <Cell><Data ss:Type="String">'+a.message+"</Data></Cell></Row>\r\n";c+=b+"\r\n"}),c+="</Table></Worksheet></Workbook>";"text/json;charset=utf-8,"+encodeURIComponent(c);a=document.createElement("a"),a.target="_blank",a.href="data:text/json;charset=utf-8,"+encodeURIComponent(c),a.download="report.xls",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}]),app.controller("historyController",["$scope","$cookieStore","$location","$http","$state",function(a,b,c,d,e){e.go("history.charge")}]),app.controller("homeController",["$rootScope","$scope","$cookieStore","$location","$http","$state",function(a,b,c,d,e,f){var g=c.get(config.cookie_token)||{};return g.value?(debug("Go Home..."),$("#login-menu").hide(),$("#user-menu").show(),e.get(config.url+"portal/user").then(function(b){a.user=b.data,0==a.user.sell&&$("#sellModal").modal("show")},function(a){handlerError(a.status,a.data.message)}),e.get(config.url+"portal/fee").then(function(b){a.discount=b.data},function(a){handlerError(a.status,a.data.message)}),void e.get(config.url+"portal/alert").then(function(b){a.alert=b.data},function(a){handlerError(a.status,a.data.message)})):void(window.location="index.html")}]),app.controller("logBalanceController",["$scope","$cookieStore","$location","$http","$timeout",function(b,c,d,e,f){function g(){e.get(config.url+"portal/log-balance?fromDate="+$("input[name=fromDate]").val()+"&toDate="+$("input[name=toDate]").val()).then(function(a){b.data=a.data},function(a){handlerError(a.status,a.data.message)})}g(),b.history=function(){g()},b.report=function(){var c='<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40"> <Worksheet ss:Name="Sheet1"> <Table>\r\n';c+='<Row><Cell><Data ss:Type="String">Thời gian</Data></Cell> <Cell><Data ss:Type="String">Tham chiếu</Data></Cell> <Cell><Data ss:Type="String">Loại</Data></Cell> <Cell><Data ss:Type="String">Nội dung</Data></Cell> <Cell><Data ss:Type="String">Số tiền</Data></Cell> <Cell><Data ss:Type="String">Số dư</Data></Cell></Row>\r\n',b.data.forEach(function(a){var b='<Row><Cell><Data ss:Type="String">'+formatDate(a.createTime)+'</Data></Cell> <Cell><Data ss:Type="String">'+a.id+'</Data></Cell> <Cell><Data ss:Type="String">'+a.service+'</Data></Cell> <Cell><Data ss:Type="String">'+a.content+'</Data></Cell> <Cell><Data ss:Type="String">'+a.type+a.amount+'</Data></Cell> <Cell><Data ss:Type="String">'+a.balance+"</Data></Cell></Row>\r\n";c+=b+"\r\n"}),c+="</Table></Worksheet></Workbook>";"text/json;charset=utf-8,"+encodeURIComponent(c);a=document.createElement("a"),a.target="_blank",a.href="data:text/json;charset=utf-8,"+encodeURIComponent(c),a.download="report.xls",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}]),app.controller("loginController",["$rootScope","$scope","$cookieStore","$location","$http","$timeout",function(a,b,c,d,e,f){c.remove(config.cookie_token),e.defaults.headers.common[config.header_token]="",b.login=function(){var a={username:$("input[name=username]").val(),password:$("input[name=password]").val(),remember:$("input[name=remember]").prop("checked")};e.post(config.url+"portal/login",a).then(function(a){if(0==a.data.code){var b={value:a.data.token.value,expire:a.data.token.expire};e.defaults.headers.common[config.header_token]=b.value,c.put(config.cookie_token,b),d.path("/")}else show(a.data.code,a.data.message)},function(a){handlerError(a.status,a.data.message)})},b.gotoGGLogin=function(){e.get(config.url+"portal/google-oauth-url").then(function(a){debug(a.data.message),window.location.href=a.data.message})},b.gotoFBLogin=function(){e.get(config.url+"portal/facebook-oauth-url").then(function(a){debug(a.data.message),window.location.href=a.data.message})}}]),app.controller("logoutController",["$rootScope","$scope","$cookieStore","$location","$http","$timeout",function(a,b,c,d,e,f){e.get(config.url+"portal/logout").then(function(a){}),c.remove(config.cookie_token),e.defaults.headers.common[config.header_token]="",d.path("/wapper.html")}]),app.controller("paymentController",["$rootScope","$scope","$cookieStore","$location","$http","$state",function(a,b,c,d,e,f){var g=c.get(config.cookie_token)||{};return g.value?(e.get(config.url+"portal/bank").then(function(a){b.data=a.data,b.data.forEach(function(a){var c=a.bank+" - "+a.account+" - "+a.name,d={name:c,value:a.account};b.options.push(d)})},function(a){handlerError(a.status,a.data.message)}),b.payment=function(){BootstrapDialog.show({type:BootstrapDialog.TYPE_DEFAULT,title:"Xác nhận",message:'Nhập mật khẩu cấp 2: <input type="password" class="form-control x1">'+(1==a.user.useOdp?'Nhập mã ODP: <input type="password" class="form-control x2">':""),buttons:[{label:"Hủy bỏ",action:function(a){a.close()}},{label:"Đồng ý",action:function(c){var d={account:$("select[name=account]").val().replace("string:",""),amount:b.amount,password2:c.getModalBody().find("input.x1").val(),odp:c.getModalBody().find("input.x2").val()};e.post(config.url+"portal/payment",d).then(function(b){show(b.data.code,b.data.message),0==b.data.code&&e.get(config.url+"portal/user").then(function(b){a.user=b.data},function(a){handlerError(a.status,a.data.message)})},function(a){handlerError(a.status,a.data.message)}),c.close()}}]})},void(b.options=[])):void(window.location="index.html")}]),app.controller("profileController",["$rootScope","$scope","$cookieStore","$location","$http","$timeout",function(a,b,c,d,e,f){e.get(config.url+"portal/user").then(function(b){a.user=b.data},function(a){handlerError(a.status,a.data.message)}),b.sendOdp=function(){e.get(config.url+"portal/odp").then(function(a){show(a.data.code,a.data.message)},function(a){handlerError(a.status,a.data.message)})},b.update=function(){BootstrapDialog.show({type:BootstrapDialog.TYPE_DEFAULT,title:"Xác nhận",message:1==a.user.useOdp?'Nhập mã ODP: <input type="password" class="form-control x2">':"Cập nhật thông tin tài khoản?",buttons:[{label:"Hủy bỏ",action:function(a){a.close()}},{label:"Đồng ý",action:function(b){var c={name:$("input[name=name]").val(),email:$("input[name=email]").val(),tel:$("input[name=tel]").val(),useOdp:$("input[name=useOdp]").is(":checked")?"1":"0",odp:b.getModalBody().find("input.x2").val()};e.post(config.url+"portal/user",c).then(function(b){show(b.data.code,b.data.message),e.get(config.url+"portal/user").then(function(b){a.user=b.data},function(a){handlerError(a.status,a.data.message)})},function(a){handlerError(a.status,a.data.message)}),b.close()}}]})}}]),app.controller("registerController",["$scope","$cookieStore","$location","$http","$state",function(a,b,c,d,e){var f;d.get(config.url+"captcha").then(function(a){f=a.data.id,$("#captcha").attr("src",a.data.base64Img)},function(a){handlerError(a.status,a.data.message)}),a.register=function(){var b={name:a.name,email:a.email,password:a.password,rePassword:a.rePassword,captcha:a.captcha,captchaId:f};d.post(config.url+"portal/register",b).then(function(b){show(b.data.code,b.data.message),0==b.data.code&&(a.name="",a.email="",e.go("login"))},function(b){handlerError(b.status,b.data.message),d.get(config.url+"captcha").then(function(a){f=a.data.id,$("#captcha").attr("src",a.data.base64Img)},function(a){handlerError(a.status,a.data.message)}),a.captcha=""})},a.gotoGGLogin=function(){d.get(config.url+"portal/google-oauth-url").then(function(a){debug(a.data.message),window.location.href=a.data.message})},a.gotoFBLogin=function(){d.get(config.url+"portal/facebook-oauth-url").then(function(a){
debug(a.data.message),window.location.href=a.data.message})}}]),app.controller("softpinController",["$rootScope","$scope","$cookieStore","$location","$http","$state",function(a,b,c,d,e,f){function g(){var b=$("input[name=provider]:checked").val(),c=$("input[name=provider]:checked").attr("title"),d=$("select[name=amount]").val(),e=$("input[name=quantity]").val();if(isNaN(d)||isNaN(e)||0>=d||0>=e||e>1e3)$("#confirm").hide();else{var f=formatCurrency(d*e*(1-a.discount.softpin[b]));void 0===f||null===f?$("#confirm").hide():($("#confirm").html('<i class="control-label">Xác nhận mua <strong>'+e+"</strong> thẻ <strong>"+c+"</strong> "+formatCurrency(d)+", thanh toán: <strong>"+f+"</strong> VNĐ</i>"),$("#confirm").show())}}void 0==a.user&&debug("true"),$("input:radio").change(function(){$("div label.btn").attr("class","btn btn-default"),$("input[name=provider]:checked").parent().attr("class","btn btn-default active"),"carot"==$("input[name=provider]:checked").val()?$("#select-amount").html('<select name="amount" class="form-control"> <option value="50000">50.000</option> <option value="100000">100.000</option> <option value="200000">200.000</option> <option value="500000">500.000</option> <option value="1000000">1.000.000</option> </select>'):"vcoin"==$("input[name=provider]:checked").val()?$("#select-amount").html('<select name="amount" class="form-control"> <option value="20000">20.000</option> <option value="50000">50.000</option> <option value="100000">100.000</option> <option value="200000">200.000</option> <option value="500000">500.000</option> <option value="1000000">1.000.000</option> </select>'):"vin"==$("input[name=provider]:checked").val()?$("#select-amount").html('<select name="amount" class="form-control"> <option value="20000">20.000</option> <option value="50000">50.000</option> <option value="100000">100.000</option> <option value="200000">200.000</option> <option value="500000">500.000</option> <option value="1000000">1.000.000</option> <option value="2000000">2.000.000</option> </select>'):$("#select-amount").html('<select name="amount" class="form-control"> <option value="10000">10.000</option> <option value="20000">20.000</option> <option value="50000">50.000</option> <option value="100000">100.000</option> <option value="200000">200.000</option> <option value="500000">500.000</option> </select>'),$("select[name=amount]").on("change",function(){g()})}),$("input[name=provider]").on("change",function(){g()}),$("input[name=quantity]").on("change",function(){g()}),b.softpin=function(){BootstrapDialog.show({type:BootstrapDialog.TYPE_DEFAULT,title:"Xác nhận",message:'Nhập mật khẩu cấp 2: <input type="password" class="form-control x1">'+(1==a.user.useOdp?'Nhập mã ODP: <input type="password" class="form-control x2">':""),buttons:[{label:"Hủy bỏ",action:function(a){a.close()}},{label:"Đồng ý",action:function(c){var d={provider:$("input[name=provider]:checked").val(),amount:$("select[name=amount]").val(),quantity:$("input[name=quantity]").val(),password2:c.getModalBody().find("input.x1").val(),odp:c.getModalBody().find("input.x2").val()};e.post(config.url+"portal/softpin",d).then(function(c){if(show(c.data.code,c.data.message),0==c.data.code){b.softpinList=c.data.softpinList,$("#result").show();var d="Stt	 Loại	Mệnh giá	Serial		Mã thẻ		Hạn sử dụng\r\n",f=1;for(var g in b.softpinList)d+=f+"	"+b.softpinList[g].provider+"	"+b.softpinList[g].amount+"	"+b.softpinList[g].serial+"	"+b.softpinList[g].pin+"	"+b.softpinList[g].expire+"\r\n",f++;var h="text/json;charset=utf-8,"+encodeURIComponent(d);$("#exportData").html('<a href="data:'+h+'" download="mã thẻ.txt"><i class="fa fa-download"></i> Tải file </a>'),document.getElementById("exportData").scrollIntoView(),e.get(config.url+"portal/user").then(function(b){a.user=b.data},function(a){handlerError(a.status,a.data.message)})}},function(a){handlerError(a.status,a.data.message)}),c.close()}}]})}}]),app.controller("topupController",["$rootScope","$scope","$cookieStore","$location","$http","$state",function(a,b,c,d,e,f){b.topup=function(){BootstrapDialog.show({type:BootstrapDialog.TYPE_DEFAULT,title:"Xác nhận",message:'Nhập mật khẩu cấp 2: <input type="password" class="form-control x1">'+(1==a.user.useOdp?'Nhập mã ODP: <input type="password" class="form-control x2">':""),buttons:[{label:"Hủy bỏ",action:function(a){a.close()}},{label:"Đồng ý",action:function(c){var d={target:b.target,amount:$("select[name=amount]").val(),password2:c.getModalBody().find("input.x1").val(),odp:c.getModalBody().find("input.x2").val()};e.post(config.url+"portal/topup",d).then(function(b){show(b.data.code,b.data.message),0==b.data.code&&e.get(config.url+"portal/user").then(function(b){a.user=b.data},function(a){handlerError(a.status,a.data.message)})},function(a){handlerError(a.status,a.data.message)}),c.close()}}]})}}]),app.controller("transferController",["$rootScope","$scope","$cookieStore","$location","$http","$state",function(a,b,c,d,e,f){b.name="",b.amount=0,$("input[name=email]").on("change",function(){e.get(config.url+"portal/check-user?email="+b.email).then(function(a){b.name=a.data.name},function(a){handlerError(a.status,a.data.message)})}),b.transfer=function(){BootstrapDialog.show({type:BootstrapDialog.TYPE_DEFAULT,title:"Xác nhận",message:'Nhập mật khẩu cấp 2: <input type="password" class="form-control x1">'+(1==a.user.useOdp?'Nhập mã ODP: <input type="password" class="form-control x2">':""),buttons:[{label:"Hủy bỏ",action:function(a){a.close()}},{label:"Đồng ý",action:function(c){var d={email:b.email,amount:b.amount,password2:c.getModalBody().find("input.x1").val(),odp:c.getModalBody().find("input.x2").val()};e.post(config.url+"portal/transfer",d).then(function(c){show(c.data.code,c.data.message),0==c.data.code&&(e.get(config.url+"portal/user").then(function(b){a.user=b.data},function(a){handlerError(a.status,a.data.message)}),b.email="",b.amount=0)},function(a){handlerError(a.status,a.data.message)}),c.close()}}]})}}]),app.controller("wapperController",["$rootScope","$scope","$cookieStore","$location","$http","$stateParams",function(a,b,c,d,e,f){if(!isEmpty(f.token)){var g={value:f.token,expire:f.expire};return e.defaults.headers.common[config.header_token]=g.value,c.put(config.cookie_token,g),void d.path("/")}debug("Go Wapper..."),$("#user-menu").hide(),$("#login-menu").show()}]);var ChuSo=new Array(" không "," một "," hai "," ba "," bốn "," năm "," sáu "," bảy "," tám "," chín "),Tien=new Array(""," nghìn"," triệu"," tỷ"," nghìn tỷ"," triệu tỷ");const SUCCESS=0;angular.module("caco.ClientPaginate",[]).filter("paginate",["Paginator",function(a){return function(b,c){return b?(c&&(a.rowsPerPage=c),a.itemCount=b.length,a.page*c>a.itemCount?(a.page=0,b):b.slice(parseInt(a.page*a.rowsPerPage),parseInt((a.page+1)*a.rowsPerPage+1)-1)):b}}]).filter("forLoop",function(){return function(a,b,c){a=new Array(c-b);for(var d=0;c>b;b++,d++)a[d]=b;return a}}).service("Paginator",["$rootScope",function(a){this.page=0,this.rowsPerPage=50,this.itemCount=0,this.limitPerPage=5,this.setPage=function(a){a>this.pageCount()||(this.page=a)},this.nextPage=function(){this.isLastPage()||this.page++},this.perviousPage=function(){this.isFirstPage()||this.page--},this.firstPage=function(){this.page=0},this.lastPage=function(){this.page=this.pageCount()-1},this.isFirstPage=function(){return 0==this.page},this.isLastPage=function(){return this.page==this.pageCount()-1},this.pageCount=function(){return Math.ceil(parseInt(this.itemCount)/parseInt(this.rowsPerPage))},this.lowerLimit=function(){var a=this.pageCount()-this.limitPerPage;if(0>a)return 0;if(this.page>a+1)return a;var b=this.page-(Math.ceil(this.limitPerPage/2)-1);return Math.max(b,0)}}]).directive("paginator",function(){return{restrict:"E",controller:["$scope","Paginator",function(a,b){a.paginator=b}],templateUrl:"./pages/pagination.html"}});